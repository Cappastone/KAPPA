<!DOCTYPE html>
<html lang="en">
<html  xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en">
<head th:replace="partials/partials.html :: head ('View Profile')">
<body>
<nav th:replace="partials/partials.html :: navbar"></nav>
<!--header -->

<!--display logged-in user's profile info-->
<div th:if="${user}">
    <p th:text="${user.username}"></p>

    <div th:if="${user.profilePictureUrl}">
        <img th:src="${user.profilePictureUrl}" alt="profile-picture">
        <p th:text="${user.bio}"></p>
    </div>

    <div th:if="!${user.profilePictureUrl}">
        <img src="https://static1.colliderimages.com/wordpress/wp-content/uploads/2022/04/Best-Creations-From-Dexters-Laboratory.jpg" alt="profile-picture">
        <p th:text="${user.bio}"></p>
    </div>



    <!-- Button trigger modal for Edit Bio-->
    <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#exampleModal">
        Edit Bio
    </button>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Edit Bio</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!--    edit bio form-->
                    <form action="/user/edit-bio" method="POST">
                        <div class="mb-3">
                            <input type="hidden" name="id" th:value="${user.id}">
                            <textarea class="form-control" id="bio" name="bio" rows="3" th:value="${user.bio}"></textarea>
                        </div>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <input type="submit" value="Update" class="btn btn-dark w-25">
                    </form>
                    <!--    end edit bio form-->
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->

    <input type="submit" value="Edit Profile Picture" class="btn btn-dark">

    <hr>

<!--    display logged-in user's Follower info-->
    <div th:if="${user.followers}">
        <p th:text="'Followers: ' + ${user.followers.size()}"></p>
        <div th:each="follower : ${user.followers}">
            <p th:text="${follower.username}"></p>
            <p th:text="'User Id: ' + ${follower.id}"></p>
            <img th:src="${follower.profilePictureUrl}">
        </div>
    </div>

    <hr>

<!--    display users that a logged-in user is Following-->
    <div th:if="${following}">
        <p th:text="'Following: ' + ${following.size()}"></p>
        <div th:each="following : ${following}">
<!--            <p th:text="${following.username}"></p>-->
            <a th:text="${following.username}" th:href="'user/' + ${following.id}"></a>
            <img th:src="${following.profilePictureUrl}">
        </div>
    </div>

    <hr>

<!--    display the logged-in user's Favorite Games info-->
    <div th:if="${user.favoriteGames}">
        <p th:text="'Favorite Games: ' + ${user.favoriteGames.size()}"></p>
        <div th:each="game : ${user.favoriteGames}">
<!--            <p th:text="${game.title}"></p>-->
            <a th:text="${game.title}" th:href="'/game?gameID=' + ${game.gamesApiId}"></a>
        </div>
    </div>

    <hr>

<!--    display the Platform Links of a logged-in user-->
    <div th:if="${user.links}">
        <p>Platform Links:</p>
        <p th:text="'Discord: ' + ${user.links.discord}"></p>
        <p th:text="'Nintendo: ' + ${user.links.nintendo}"></p>
        <p th:text="'Playstation: ' + ${user.links.playstation}"></p>
        <p th:text="'Twitch: ' + ${user.links.twitch}"></p>
        <p th:text="'Xbox: ' + ${user.links.xbox}"></p>
        <p th:text="'YouTube: ' + ${user.links.youtube}"></p>
    </div>

    <hr>

<!--    display all the Posts that the logged-in user has created-->
    <div th:if="${posts}">
<!--        <form id="like-post" action="/user/like" method="post"></form>-->
        <div th:each="post : ${posts}">
            <p th:text="'Post #' + ${post.id}"></p>
            <p th:text="${post.creationDate}"></p>
            <p th:text="${post.body}"></p>
            <p th:text="'Likes: ' + ${post.usersThatLiked.size()}"></p>
            <p>Comments:</p>
            <div th:each="comment : ${post.comments}">
<!--                <p th:text="${comment.user.username} + ' said: ' + ${comment.comment}"></p>-->
                <a th:text="${comment.user.username}" th:href="'user/' + ${comment.user.id}"></a>
                <p th:text="${comment.comment}"></p>
            </div>

            <div th:each="image : ${post.postImages}">
    <!--            <p th:text="${image.title}"></p>-->
                <p th:text="${image.url}"></p>
            </div>

<!--            JavaScript listener to Like a Post using an Ajax request-->
<!--            <input form="like-post" type="hidden" name="like-post" th:value="${post.id}">-->

            <div th:if="${ListPostIdLikedByUserId.contains(post.id)}">
                <button th:data="${post.id} + ',' + ${sessionUserId}" class="like-btn btn btn-primary">Like Post</button>
            </div>

            <div th:if="${!ListPostIdLikedByUserId.contains(post.id)}">
                <button th:data="${post.id} + ',' + ${sessionUserId}" class="like-btn btn btn-secondary">Like Post</button>
            </div>


<!--            <div th:each="likePostId : ${ListPostIdLikedByUserId}">-->

<!--                <div th:with="condition=${post.id == likePostId}">-->

<!--                    <button th:if="${post.id == likePostId}" th:data="${post.id} + ',' + ${sessionUserId}" class="like-btn btn btn-primary">Like Post</button>-->
<!--                    <button th:if="${post.id != likePostId}" th:data="${post.id} + ',' + ${sessionUserId}" class="like-btn btn btn-secondary">Like Post</button>-->
<!--                </div>-->
<!--                <div th:unless="${post.id == likePostId}">-->
<!--                    <button th:data="${post.id} + ',' + ${sessionUserId}" class="like-btn btn btn-secondary">Like Post</button>-->
<!--                </div>-->
<!--                    <button class="like-btn btn btn-secondary" th:classappend="${post.id == likePostId} ? btn-primary : btn-secondary  " th:data="${post.id} + ',' + ${sessionUserId}">Like Post</button>-->
<!--                <a href="" class="baseclass" th:classappend="${isAdmin} ? adminclass : userclass"></a>-->


<!--            </div>-->

            <hr>
        </div>
    </div>

</div>

<!--partials needed on every page-->
<footer th:replace="partials/partials.html :: footer"></footer>
<div th:replace="partials/partials.html :: scripts"></div>

</body>
</html>