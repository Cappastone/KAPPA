<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="en">
<head th:replace="partials/partials.html :: head ('Main')">
<body>
<nav th:replace="partials/partials.html :: navbar"></nav>
<!--header-->

<!--display logged-in user-->
<div th:if="${user}">

    <span id="username" style="visibility: hidden" th:text="${user.username}"></span>
    <p th:text="${user.username} + ' is logged in'"></p>
    <div th:if="${user.profilePictureUrl}">
        <img style="object-fit: cover; height: 150px; width:200px;" th:src="${user.profilePictureUrl}">
    </div>
    <div th:if="!${user.profilePictureUrl}">
        <img src="https://static1.colliderimages.com/wordpress/wp-content/uploads/2022/04/Best-Creations-From-Dexters-Laboratory.jpg" alt="profile-picture">
        <p th:text="${user.bio}"></p>
    </div>

<!--    for some reason this does not display-->
    <div th:if="!${following}">
        <p>You are not following anyone :[</p>
    </div>
</div>

<div>
    <fieldset>
        <legend>Create Post</legend>
        <form th:action="@{/main/create-post}" th:method="POST" th:object="${newPost}">
            <input th:field="*{body}">
            <div id="img-output"></div>
            <input type="hidden" class="post-image-upload" name="post-image-upload">
            <button type="button" class="upload-picture">Upload Picture</button>
            <input type="submit">
        </form>
    </fieldset>
</div>

<!--display Posts from users that the logged-in user is Following-->
<div th:if="${followingPosts}">
    <hr>
    <!--        <form id="like-post" action="/user/like" method="post"></form>-->
    <div th:each="post : ${followingPosts}">
        <p th:text="'Post #' + ${post.id}"></p>
        <a th:text="${post.user.username}" th:href="'/user/' + ${post.user.id}"></a>
<!--        <p th:text="${post.creationDate}"></p>-->
        <p th:text="${postCreationDates[postStat.index]}"></p>

        <p th:text="${post.body}"></p>
        <p th:text="'Likes: ' + ${post.usersThatLiked.size()}"></p>
<!--        <p class="like-count" th:data-ps="${post.id}" th:text="'Likes: ' + ${post.usersThatLiked.size()}" th:data-id="${post.usersThatLiked.size()}"></p>-->

<!--        <button name="edit" th:data-id="${post.id}" class="btn btn-primary edit btn2">Edit Post</button>-->

        <div th:if="${post.comments}" class="comments-container" th:data-id="${post.id}">
            <p>Comments:</p>
            <div th:each="comment : ${post.comments}" >
    <!--            <p th:text="${comment.user.username} + ' said: ' + ${comment.comment}"></p>-->

                <a th:text="${comment.user.username}" th:href="'/user/' + ${comment.user.id}" class="dl" th:data-dl="${comment.id}"></a>
                <p th:text="${comment.body}" class="dl" th:data-dl="${comment.id}"></p>

                <div th:if="${findCommentIdsByUserId.contains(comment.id)}">
                    <button th:data="${comment.id}" class="dl" th:data-dl="${comment.id}" >X</button>
                </div>

<!--                <a th:text="${comment.user.username}" th:href="'/user/' + ${comment.user.id}"></a>-->
<!--                <p th:text="${comment.body}"></p>-->

<!--                <div th:if="${findCommentIdsByUserId.contains(comment.id)}">-->
<!--                    <button th:data="${comment.id}">Delete Comment</button>-->
<!--                </div>-->


            </div>
        </div>
        <div th:if="!${post.comments}">
            <p>No comments yet, be the first!</p>
        </div>

        <div>
<!--            <fieldset>-->
<!--                <form th:action="@{/main/comment}" th:method="POST" th:object="${newComment}">-->
<!--                    <input th:field="*{body}" name="body">-->
<!--                    <input type="hidden" th:value="${post.id}" name="postId">-->
<!--                    <input type="submit" value="Comment">-->
<!--                </form>-->
<!--                <br>-->
<!--            </fieldset>-->
            <input type="text" th:data-id="${post.id}" name="comment-body" class="comment-body">
            <button  th:data="${sessionUserId} + ',' + ${post.id}" class="post-comment-btn" th:data-id="${post.id}">Post Comment</button>
        </div>

        <div th:each="image : ${post.postImages}">
            <img style="object-fit: cover; height: 150px; width:200px" th:src="${image.url}">
        </div>

        <div th:if="${ListPostIdLikedByUserId.contains(post.id)}">
            <button th:data="${post.id} + ',' + ${sessionUserId}" class="like-btn btn btn-primary">Like Post</button>
        </div>
        <div th:if="${!ListPostIdLikedByUserId.contains(post.id)}">
            <button th:data="${post.id} + ',' + ${sessionUserId}" class="like-btn btn btn-secondary">Like Post</button>
        </div>

<!--        JavaScript listener used to Like a Post -->
<!--        <button th:data="${post.id} + ',' + ${sessionUserId}" class="like-btn btn btn-secondary">Like Post</button>-->

        <hr>
    </div>
</div>

<!--footer and JS partials needed on every page-->
<footer th:replace="partials/partials.html :: footer"></footer>
<div th:replace="partials/partials.html :: scripts"></div>
</body>
</html>